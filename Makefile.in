# The top-level Makefile that is used to build 

# State the platforms for which we are building
BUILD_FOR_LINUX=@BUILD_FOR_LINUX@
BUILD_FOR_WINDOWS=@BUILD_FOR_WINDOWS@
BUILD_FOR_PYTHON=@BUILD_FOR_PYTHON@

SUBDIRS := c
ifeq ($(BUILD_FOR_PYTHON),yes)
SUBDIRS += python
endif
SUBDIRS += tests

ifdef PRINT_DIRECTORIES
MAKE_CMD = $(MAKE) -j -l 5.0 
MAKE_DIR = $(MAKE_CMD) -C $(dir)
else
MAKE_CMD = $(MAKE) -j -l 5.0 --no-print-directory -s 
MAKE_DIR = $(MAKE_CMD) -C $(dir)
endif

ifeq ($(BUILD_FOR_LINUX),yes)
LINUX_LIBS_DIR = @RDFADIR@/libs/linux
endif

ifeq ($(BUILD_FOR_WINDOWS),yes)
WINDOWS_LIBS_DIR = @RDFADIR@/libs/windows
endif

.PHONY: all verbose clean test docs

all: docs
	@$(foreach dir,$(SUBDIRS),$(MAKE_DIR) build-objects build-libraries &&) true
	@$(foreach dir,$(SUBDIRS),$(MAKE_DIR) build-executables &&) true

clean:
	@$(foreach dir,$(SUBDIRS),MAKE_CLEAN_ACTIVE=true $(MAKE_DIR) clean &&) true
	@rm -rf libs/*
	@echo "Removed all objects and libraries."

tests: all
	LD_LIBRARY_PATH=@RDFADIR@/libs/linux tests/dist/linux/curies
	LD_LIBRARY_PATH=@RDFADIR@/libs/linux tests/dist/linux/rdfa2n3 tests/testsuite/0001.xhtml

docs:
	@$(MAKE_DIR) docs

verbose:
	PRINT_DIRECTORIES=true $(MAKE) all
